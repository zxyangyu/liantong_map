<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE"/>
    <!--    <link rel="stylesheet" href="css/index.css" />-->
    <!--    <script type="text/javascript" src="Plugins/jquery-easyui/jquery.min.js"></script>-->
    <script type="text/javascript" src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>


    <script>
        function goBackProMap() {
            $('#cont_pro_map').css('display', 'block');
            $('#cont_city_map').css('display', 'none');
            $('.retPro').css('display', 'none');
        }
    </script>
</head>
<body>
<div class="main" style="width:1300px;height:680px;margin:50px auto;">
    <div id="p" style="width:1300px;height:680px;padding:10px;background:#F6F8F7;">
        <div class="proj fl pro_map" style="position: relative;">
            <div class="proj_top">
                <p>地图总览</p>
            </div>
            <div class="retPro">
                <a href="javascript:void(0);" onclick="goBackProMap()">
                    返回省级地图
                </a>
            </div>
            <div id="cont_pro_map"
                 style="width:1080px;height:500px;float:left;position: absolute;left:10px;top:50px;z-index:1;"></div>
            <div id="cont_city_map"
                 style="width:1080px;height:500px;float:left;display: none;position: absolute;left:10px;top:50px;z-index:99;"></div>

        </div>

    </div>
</div>

<script>
    $().ready(function () {
        /*echarts*/
        var cdn_url = 'https://cdn.jsdelivr.net/gh/zxyangyu/liantong_map/city_geo/'
        $.get(cdn_url + '440000_full.json', function (mapJson) {
            echarts.registerMap('guang_zhou', mapJson);
            var chart = echarts.init(document.getElementById('cont_pro_map'));//在id为mainMap的dom元素中显示地图
            var myChartCity
            var json_data

            var convertJson = function (data) {
                var res = [];
                for (var i = 0; i < data.length; i++) {
                    if (data[i].city === 'CN-44-03') {
                        res.push({
                            name: data[i].imei,
                            value: [data[i].lng, data[i].lat]
                        });
                    }
                }
                console.log(res);
                return res;
            };


            chart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: function loadData(result) {//回调函数，参数params具体格式参加官方API
                        //鼠标放到某个地市上，显示这个地市的名称加人口数
                        //例如 params.name：当前地市名称。params.value：你传入的json数据与当前地市匹配的一项。
                        //params.data.value:你传入的json数据与当前地市匹配的一项中'value'对应的数据
                        return result.name + '<br />活跃人数:' + result.value;
                    }
                },
                dataRange: {
                    min: 0,
                    max: 50,
                    splitNumber: 0,
                    text: ['高', '低'],
                    calculable: false,
                    selectedMode: false,
                    realtime: false,
                    itemWidth: 10,
                    itemHeight: 60,
                    color: ['lightskyblue', '#f2f2f2']
                },
                title: {
                    text: '广州省各市区数据总览',
                    //subtext:'',
                    x: 'center',
                    y: 'top',
                    textAlign: 'left'
                },
                series: [{
                    type: 'map',
                    map: 'guang_zhou',//要和echarts.registerMap（）中第一个参数一致
                    scaleLimit: {min: 0.8, max: 1.9},//缩放
                    zoom: 1, //当前视角的缩放比例
                    roam: true, //是否开启平游或缩放

                    mapLocation: {
                        y: 60
                    },
                    itemSytle: {
                        emphasis: {label: {show: false}}
                    },
                    label: {
                        normal: {
                            show: true
                        },
                        emphasis: {
                            show: true
                        }
                    },
                    data: [
                        {name: '深圳市', value: '99'},
                        {name: '惠州市', value: '20'},
                        {name: '汕头市', value: '10'},
                        {name: '汕尾市', value: '30'},
                        {name: '揭阳市', value: '50'},
                        {name: '肇庆市', value: '15'},
                        {name: '广州市', value: '33'},
                    ]//dataParam//人口数据：例如[{name:'济南',value:'100万'},{name:'菏泽'，value:'100万'}......]
                }
                ]
            })


            chart.on('click', function (result) {//回调函数，点击时触发，参数params格式参加官方API
                // loading 动画
                // chart.showLoading({
                //     text: 'loading',
                //     color: '#c23531',
                //     textColor: '#000',
                //     maskColor: 'rgba(255, 255, 255, 0.2)',
                //     zlevel: 0,
                // });
                // 清空实例重新渲染
               if (myChartCity){
                        myChartCity.dispose()
                    }
                setTimeout(function () {
                    $('#cont_pro_map').css('display', 'none');
                    $('#cont_city_map').css('display', 'block');
                    $('.retPro').css('display', 'block');
                    // chart.hideLoading();

                }, 500);
                //选择地级市的单击事件
                var selectCity = result.name;
                //alert(selectCity);
                //    调取后台数据

                $.get(cdn_url + selectCity + '.json', function (Citymap) {
                    echarts.registerMap(selectCity, Citymap);
                    myChartCity = echarts.init(document.getElementById('cont_city_map'));
                    // $.get('../data/result_json_20210830.json').done(function (data) {
                    myChartCity.setOption({
                        backgroundColor: '#046486',
                        geo: {
                            map: selectCity,
                            roam: false,
                            label: {show: false},
                            // 定义样式
                            itemStyle: {
                                label: {show: false},
                                // 普通状态下的样式
                                normal: {
                                    areaColor: '#ABCDEF99',
                                    borderColor: '#fff'
                                },
                                // 高亮状态下的样式,默认黄色
                                emphasis: {
                                    areaColor: 'white'
                                }
                            },
                            emphasis: {
                                label: {show: false}
                            }
                        },

                        tooltip: {
                            // show:false,
                            // trigger: 'item',
                            // formatter: function loadData(result) {//回调函数，参数params具体格式参加官方API
                            //     //鼠标放到某个地市上，显示这个地市的名称加人口数
                            //     //例如 params.name：当前地市名称。params.value：你传入的json数据与当前地市匹配的一项。
                            //     //params.data.value:你传入的json数据与当前地市匹配的一项中'value'对应的数据
                            //     return result.name + '<br />活跃人数:' + result.value;
                            // }
                        },
                        title: {
                            text: selectCity + '地图数据总览',
                            x: 'center',
                            y: 'top',
                            textAlign: 'left'
                        },
                        // 填入数据

                    });
                    $.get('../data/result_json_20210830.json').done(function (data) {
                        myChartCity.setOption({
                            series: [{
                                name: 'shanshan',            // series名称
                                type: 'scatter',          // series图表类型
                                coordinateSystem: 'geo',  // series坐标系类型
                                blendMode: 'lighter',   // 叠加效果
                                symbolSize: 4,
                                //Scatter才有这个属性,是否开启鼠标 hover 的提示动画效果
                                hoverAnimation: false,
                                // data: convertJson(json_data),  // series数据内容
                                data: convertJson(data),  // series数据内容
                                //控制显示文本
                                label: {
                                    show: false
                                },
                                //series样式
                                itemStyle: {
                                    color: 'white',
                                    opacity: 0.5,
                                },
                                tooltip: {
                                    trigger: 'item',
                                    show: false
                                },
                            }
                            ]
                        })
                    });
                });
                // myChartCity.on('click', function (rel) {
                //     setTimeout(function () {
                //         //$('#cont_pro_map').css('display','block');
                //         //$('#cont_city_map').css('display','none');
                //     }, 500);
                // })
            });
        });
    })
    ;
</script>
</body>
</html>